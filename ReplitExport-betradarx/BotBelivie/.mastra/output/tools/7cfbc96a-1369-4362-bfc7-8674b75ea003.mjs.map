{"version":3,"file":"7cfbc96a-1369-4362-bfc7-8674b75ea003.mjs","sources":["../../../src/mastra/tools/storeAlert.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\nimport { z } from \"zod\";\nimport pg from \"pg\";\n\nexport const storeAlert = createTool({\n  id: \"store-alert\",\n  description: \"Stores a football match alert prediction in the database\",\n  \n  inputSchema: z.object({\n    fixtureId: z.number().describe(\"The match fixture ID\"),\n    minute: z.number().describe(\"The minute when alert was triggered\"),\n    pressTotal: z.number().describe(\"Total pressure metric\"),\n    pressDiff: z.number().describe(\"Pressure difference between teams\"),\n    corners: z.number().describe(\"Total corners in the match\"),\n    shotsOnGoal: z.number().describe(\"Total shots on goal\"),\n    goalsAtAlert: z.number().describe(\"Total goals in match when alert was sent\"),\n  }),\n  \n  outputSchema: z.object({\n    success: z.boolean(),\n    alertId: z.number().optional(),\n    error: z.string().optional(),\n  }),\n  \n  execute: async ({ context, mastra }) => {\n    const logger = mastra?.getLogger();\n    logger?.info(\"üîß [storeAlert] Starting execution\", {\n      fixtureId: context.fixtureId,\n      minute: context.minute,\n    });\n    \n    const connectionString = process.env.DATABASE_URL;\n    if (!connectionString) {\n      logger?.error(\"‚ùå [storeAlert] DATABASE_URL not found\");\n      return {\n        success: false,\n        error: \"DATABASE_URL not configured\",\n      };\n    }\n    \n    const client = new pg.Client({ connectionString });\n    \n    try {\n      await client.connect();\n      \n      const query = `\n        INSERT INTO football_alerts \n        (fixture_id, minute, press_total, press_diff, corners, shots_on_goal, goals_at_alert)\n        VALUES ($1, $2, $3, $4, $5, $6, $7)\n        RETURNING id\n      `;\n      \n      const values = [\n        context.fixtureId,\n        context.minute,\n        context.pressTotal,\n        context.pressDiff,\n        context.corners,\n        context.shotsOnGoal,\n        context.goalsAtAlert,\n      ];\n      \n      logger?.info(\"üíæ [storeAlert] Inserting alert into database\", { values });\n      \n      const result = await client.query(query, values);\n      const alertId = result.rows[0]?.id;\n      \n      logger?.info(\"‚úÖ [storeAlert] Alert stored successfully\", { alertId });\n      \n      return {\n        success: true,\n        alertId,\n      };\n    } catch (error: any) {\n      logger?.error(\"‚ùå [storeAlert] Error storing alert\", {\n        error: error.message,\n      });\n      \n      return {\n        success: false,\n        error: error.message || \"Unknown error occurred\",\n      };\n    } finally {\n      await client.end();\n    }\n  },\n});\n"],"names":[],"mappings":";;;;AAIO,MAAM,aAAa,UAAA,CAAW;AAAA,EACnC,EAAA,EAAI,aAAA;AAAA,EACJ,WAAA,EAAa,0DAAA;AAAA,EAEb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,sBAAsB,CAAA;AAAA,IACrD,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,qCAAqC,CAAA;AAAA,IACjE,UAAA,EAAY,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,uBAAuB,CAAA;AAAA,IACvD,SAAA,EAAW,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,mCAAmC,CAAA;AAAA,IAClE,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,4BAA4B,CAAA;AAAA,IACzD,WAAA,EAAa,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,qBAAqB,CAAA;AAAA,IACtD,YAAA,EAAc,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,0CAA0C;AAAA,GAC7E,CAAA;AAAA,EAED,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,OAAA,EAAS,EAAE,OAAA,EAAQ;AAAA,IACnB,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA,IAC7B,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,GAC5B,CAAA;AAAA,EAED,OAAA,EAAS,OAAO,EAAE,OAAA,EAAS,QAAO,KAAM;AACtC,IAAA,MAAM,MAAA,GAAS,QAAQ,SAAA,EAAU;AACjC,IAAA,MAAA,EAAQ,KAAK,2CAAA,EAAsC;AAAA,MACjD,WAAW,OAAA,CAAQ,SAAA;AAAA,MACnB,QAAQ,OAAA,CAAQ;AAAA,KACjB,CAAA;AAED,IAAA,MAAM,gBAAA,GAAmB,QAAQ,GAAA,CAAI,YAAA;AACrC,IAAA,IAAI,CAAC,gBAAA,EAAkB;AACrB,MAAA,MAAA,EAAQ,MAAM,4CAAuC,CAAA;AACrD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAEA,IAAA,MAAM,SAAS,IAAI,EAAA,CAAG,MAAA,CAAO,EAAE,kBAAkB,CAAA;AAEjD,IAAA,IAAI;AACF,MAAA,MAAM,OAAO,OAAA,EAAQ;AAErB,MAAA,MAAM,KAAA,GAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,MAAA,CAAA;AAOd,MAAA,MAAM,MAAA,GAAS;AAAA,QACb,OAAA,CAAQ,SAAA;AAAA,QACR,OAAA,CAAQ,MAAA;AAAA,QACR,OAAA,CAAQ,UAAA;AAAA,QACR,OAAA,CAAQ,SAAA;AAAA,QACR,OAAA,CAAQ,OAAA;AAAA,QACR,OAAA,CAAQ,WAAA;AAAA,QACR,OAAA,CAAQ;AAAA,OACV;AAEA,MAAA,MAAA,EAAQ,IAAA,CAAK,sDAAA,EAAiD,EAAE,MAAA,EAAQ,CAAA;AAExE,MAAA,MAAM,MAAA,GAAS,MAAM,MAAA,CAAO,KAAA,CAAM,OAAO,MAAM,CAAA;AAC/C,MAAA,MAAM,OAAA,GAAU,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA,EAAG,EAAA;AAEhC,MAAA,MAAA,EAAQ,IAAA,CAAK,+CAAA,EAA4C,EAAE,OAAA,EAAS,CAAA;AAEpE,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT;AAAA,OACF;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,MAAA,EAAQ,MAAM,yCAAA,EAAsC;AAAA,QAClD,OAAO,KAAA,CAAM;AAAA,OACd,CAAA;AAED,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,OAC1B;AAAA,IACF,CAAA,SAAE;AACA,MAAA,MAAM,OAAO,GAAA,EAAI;AAAA,IACnB;AAAA,EACF;AACF,CAAC;;;;"}