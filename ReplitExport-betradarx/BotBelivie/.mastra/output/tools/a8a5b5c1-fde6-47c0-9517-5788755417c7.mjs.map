{"version":3,"file":"a8a5b5c1-fde6-47c0-9517-5788755417c7.mjs","sources":["../../../src/mastra/tools/getCurrentThresholds.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\nimport { z } from \"zod\";\nimport pg from \"pg\";\n\nexport const getCurrentThresholds = createTool({\n  id: \"get-current-thresholds\",\n  description: \"Retrieves the current adaptive thresholds from the database for alert evaluation\",\n  \n  inputSchema: z.object({}),\n  \n  outputSchema: z.object({\n    thresholdTotal: z.number(),\n    thresholdDiff: z.number(),\n    escanteios10min: z.number(),\n    lastUpdated: z.string(),\n    success: z.boolean(),\n    error: z.string().optional(),\n  }),\n  \n  execute: async ({ mastra }) => {\n    const logger = mastra?.getLogger();\n    logger?.info(\"üîß [getCurrentThresholds] Starting execution\");\n    \n    const connectionString = process.env.DATABASE_URL;\n    if (!connectionString) {\n      logger?.error(\"‚ùå [getCurrentThresholds] DATABASE_URL not found\");\n      return {\n        thresholdTotal: 70,\n        thresholdDiff: 15,\n        escanteios10min: 3,\n        lastUpdated: new Date().toISOString(),\n        success: false,\n        error: \"DATABASE_URL not configured\",\n      };\n    }\n    \n    const client = new pg.Client({ connectionString });\n    \n    try {\n      await client.connect();\n      \n      const query = `\n        SELECT threshold_total, threshold_diff, escanteios_10min, last_updated\n        FROM football_thresholds\n        WHERE id = 1\n      `;\n      \n      logger?.info(\"üìä [getCurrentThresholds] Querying thresholds\");\n      const result = await client.query(query);\n      \n      if (result.rows.length === 0) {\n        logger?.warn(\"‚ö†Ô∏è [getCurrentThresholds] No thresholds found, using defaults\");\n        return {\n          thresholdTotal: 70,\n          thresholdDiff: 15,\n          escanteios10min: 3,\n          lastUpdated: new Date().toISOString(),\n          success: true,\n        };\n      }\n      \n      const row = result.rows[0];\n      const thresholds = {\n        thresholdTotal: parseFloat(row.threshold_total),\n        thresholdDiff: parseFloat(row.threshold_diff),\n        escanteios10min: parseInt(row.escanteios_10min, 10),\n        lastUpdated: row.last_updated?.toISOString() || new Date().toISOString(),\n        success: true,\n      };\n      \n      logger?.info(\"‚úÖ [getCurrentThresholds] Retrieved thresholds\", thresholds);\n      \n      return thresholds;\n    } catch (error: any) {\n      logger?.error(\"‚ùå [getCurrentThresholds] Error retrieving thresholds\", {\n        error: error.message,\n      });\n      \n      return {\n        thresholdTotal: 70,\n        thresholdDiff: 15,\n        escanteios10min: 3,\n        lastUpdated: new Date().toISOString(),\n        success: false,\n        error: error.message || \"Unknown error occurred\",\n      };\n    } finally {\n      await client.end();\n    }\n  },\n});\n"],"names":[],"mappings":"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"}